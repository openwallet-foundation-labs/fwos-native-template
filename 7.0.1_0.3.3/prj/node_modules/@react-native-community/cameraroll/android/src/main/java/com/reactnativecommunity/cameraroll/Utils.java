package com.reactnativecommunity.cameraroll;

import android.content.ContentResolver;
import android.content.Context;
import android.database.Cursor;
import android.net.Uri;
import android.os.Build;
import android.provider.MediaStore;
import android.os.FileUtils;

import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;

import androidx.annotation.RequiresApi;

public class Utils {

  @RequiresApi(api = Build.VERSION_CODES.Q)
  public static void copy(File src, OutputStream out) throws IOException {
      try (InputStream in = new FileInputStream(src)) {
          FileUtils.copy(in, out);
      }
  }

  // From https://stackoverflow.com/a/64359655/1377145
  public static String getNameFromContentUri(Context context, Uri contentUri){
      ContentResolver contentResolver = context.getContentResolver();
      Cursor cursor = contentResolver.query(contentUri, null, null, null, null);
      cursor.moveToFirst();
      String[] splittedContentUri = contentUri.toString().split("/");
      String document_id = splittedContentUri[splittedContentUri.length - 1];
      cursor.close();

      cursor = contentResolver.query(
          android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI,
          null, MediaStore.Images.Media._ID + " = ? ", new String[]{document_id}, null);
      cursor.moveToFirst();
      String path = cursor.getString(cursor.getColumnIndex(MediaStore.Images.Media.DATA));
      cursor.close();
      return path;
  }
}
